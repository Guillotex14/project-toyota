<ion-content [fullscreen]="true">
  <ion-grid fixed>
    <ion-row>

      <ion-col size="12" class="header">
          <ion-row>
            <ion-col size="2">
              <ion-icon name="arrow-back-circle-sharp" class="iconBack" (click)="goBack()"></ion-icon>
            </ion-col>
            <ion-col size="8" style="text-align: center;">
              <ion-img src="assets/images/logo/logo_toyota.png" class="logoRed"></ion-img>
            </ion-col>
            <ion-col size="2">
              <ion-icon name="menu-outline" class="iconMenu" (click)="openMenu()"></ion-icon>
            </ion-col>
          </ion-row>
      </ion-col>

      <ion-col size="12">
        <ion-grid fixed>
          <ion-row>
            <ion-col size="12">
              <p class="titlePage">Detalles del vehículo</p>
            </ion-col>

            <ion-col size="12" *ngIf="!editCar" style="text-align: center !important">
              
              <ion-col sizeXl="12" sizeLg="12" sizeMd="12" sizeSm="12" sizeXs="12" *ngIf="arrayImages.length === 0">
                <ion-icon name="information-circle" class="iconSwipper"></ion-icon>
                <br>
                <span class="titleSwiper">
                  El vehículo no posee imagenes cargadas
                </span>
              </ion-col>

              <ion-col sizeXl="12" sizeLg="12" sizeMd="12" sizeSm="12" sizeXs="12" *ngIf="arrayImages.length > 0">
                <swiper-container [loop]="true" [pagination]="true">
                  <swiper-slide *ngFor="let image of arrayImages; let i = index">
                    <ion-row>
                      <ion-col size="12">
                        <ion-img [src]="image.img" style="width: 100%;height: 200px;"></ion-img>
                      </ion-col>
                    </ion-row>
                  </swiper-slide>
                  <div class="swiper-pagination"></div>
                </swiper-container>
              </ion-col>
            </ion-col>

            <!-- <input type="file" style="width: 0px;height: 0px;" #fileInput (change)="getImage($any($event).target.files)">
            <input type="file" style="width: 0px;height: 0px;" #fileInput2 (change)="getImage2($any($event).target.files)"> -->

            <ion-col size="12" style="text-align: center;" *ngIf="editCar">
              <ion-row>
                <ion-col sizeXl="12" sizeLg="12" sizeMd="12" sizeSm="12" sizeXs="12" *ngIf="arrayImages.length === 0" (click)="openActionSheet()">
                  <ion-icon name="image" class="iconSwipper" (click)="openActionSheet()"></ion-icon>
                  <br>
                  <span class="titleSwiper">Cargar imágenes</span>
                  <br>
                  <span class="subtitleSwiper">Minimo 5 fotos del vehículo (Delantera, trasera. ambos lados e interna)</span>
                </ion-col>
  
                <ion-col sizeXl="12" sizeLg="12" sizeMd="12" sizeSm="12" sizeXs="12" *ngIf="arrayImages.length > 0">
                  <swiper-container [loop]="true" [pagination]="true">
                    <swiper-slide *ngFor="let image of arrayImages; let i = index">
                      <ion-row>
                        <ion-col size="4">
                          <ion-button expand="block" shape="round" class="btnRed" (click)="deleteImage(i,image)">
                            <ion-icon name="trash" style="font-size: 30px;"></ion-icon>
                          </ion-button>
                        </ion-col>
                        <ion-col size="4">
  
                        </ion-col>
                        <ion-col size="4">
                          <ion-button expand="block" shape="round" (click)="openActionSheetEdit(i,image)" class="btnRed">
                            <ion-icon name="create" style="font-size: 30px;"></ion-icon>
                          </ion-button>
                        </ion-col>
                        <ion-col size="12">
                          <ion-img [src]="image.img" style="width: 100%;height: 200px;"></ion-img>
                        </ion-col>
                      </ion-row>
                      <!-- <ion-button expand="block" shape="round" style="margin-top: 20px;" (click)="openActionSheet()" class="btnSaveRed">
                        Agregar imagen
                      </ion-button> -->
                    </swiper-slide>
                    <div class="swiper-pagination"></div>
                  </swiper-container>
                  <ion-button expand="block" shape="round" style="margin-top: 20px;" class="btnSaveRed" (click)="openActionSheet()">
                    Agregar imagen
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-col>

            <ion-col size="12" >
              <ion-col sizeXl="12" sizeLg="12" sizeMd="12" sizeSm="12" sizeXs="12">
                <span class="spanLabel" style="margin-left: 25px !important;">Modelo</span>
              </ion-col>
              <ion-col sizeXl="12" sizeLg="12" sizeMd="12" sizeSm="12" sizeXs="12">
                <p class="pText" style="margin-left: 30px !important;">{{carDetail.model}}</p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel" class="spanLabel">Marca</span>
              </ion-col>
              <ion-col size="12">
                <p class="pText">
                  {{carDetail.brand}}
                </p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel" class="spanLabel">Motor</span>
              </ion-col>
              <ion-col size="12">
                <p class="pText">{{carDetail.engine_model}}</p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel" class="spanLabel">Año</span>
              </ion-col>
              <ion-col size="12">
                <p class="pText">
                  {{carDetail.year}}
                </p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel">Km</span>
              </ion-col>
              <ion-col size="12">
                <p class="pText">{{setDot(carDetail.km)}}</p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel">Cilindrada</span>
              </ion-col>
              <ion-col size="12">
                <p class="pText">{{carDetail.displacement}}</p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel">Combustible</span>
              </ion-col>
              <ion-col size="12" >
                <p class="pText">{{carDetail.fuel}}</p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel">Títulos</span>
              </ion-col>
              <ion-col size="12">
                <p class="pText">{{carDetail.titles}}</p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel">Transmisión</span>
              </ion-col>
              <ion-col size="12">
                <p class="pText">{{carDetail.transmission}}</p>
              </ion-col>
            </ion-col>

            <ion-col sizeXl="4" sizeLg="4" sizeMd="6" sizeSm="6" sizeXs="6" style="text-align: center !important;">
              <ion-col size="12">
                <span class="spanLabel">Tracción</span>
              </ion-col>
              <ion-col size="12">
                <p class="pText">{{carDetail.traction}}</p>
              </ion-col>
            </ion-col>

            <ion-col size="12" *ngIf="carDetail.id_seller_buyer!==null" style="text-align: center;">
              <ion-button expand="block" shape="round" class="btnYell">
                En negociación
              </ion-button>
            </ion-col>

            <ion-col size="12">
              <ion-card>
                <ion-card-content style="text-align: center !important;">
                  <ion-row>

                    <ion-col sizeXl="6" sizeLg="6" sizeMd="6" sizeSm="12" sizeXs="12">
                      <ion-row>
                        
                        <ion-col size="12" >
                          <span class="spanLabel" style="font-size: 15px !important;">Estado</span>
                        </ion-col>
                        <ion-col size="12" >
                          <ion-row>
                            <ion-col size="12" style="text-align: center !important;">
                              <span class="spanLabel2">{{carDetail.city}}</span>
                            </ion-col>
                          </ion-row>
                        </ion-col>
                      </ion-row>
                    </ion-col>

                    <ion-col sizeXl="6" sizeLg="6" sizeMd="6" sizeSm="12" sizeXs="12">
                      <ion-row>
                        <ion-col size="12">
                          <span class="spanLabel" style="font-size: 15px !important;">Concesionario</span>
                        </ion-col>
                        <ion-col size="12">
                          <span  class="spanLabel2">{{carDetail.concesionary}}</span>
                        </ion-col>
                      </ion-row>
                    </ion-col>

                    <ion-col size="12" *ngIf="carDetail.price !== null && carDetail.id_seller !== myId">
                      <ion-row>
                        <ion-col size="12" >
                          <span class="spanLabel" style="font-size: 15px;">Precio</span>
                        </ion-col>
                        <ion-col size="12">
                          <ion-icon name="logo-usd" style="font-size: 20px;"></ion-icon>
                          <span style="font-size: 18px;">{{setDot(carDetail.price)}}</span>
                        </ion-col>
                      </ion-row>
                    </ion-col>

                  </ion-row>
                </ion-card-content>
              </ion-card>
            </ion-col>
            
            <ion-col size="12" *ngIf="carDetail.mechanicalFile && carDetail.id_seller ===myId" style="text-align: center !important;">
              <ion-row>
                <ion-col size="12">
                  <span class="spanLabel" style="font-size: 18px;">Precio</span>
                </ion-col>
                <ion-col size="12">
                  <ion-col size="6">
                    <ion-row class="rowPriceEdit">
                      <ion-col size="3" style="text-align: center;">
                        <ion-icon name="logo-usd" style="font-size: 25px !important; margin: 5px auto !important"></ion-icon>
                      </ion-col>
                      <ion-col size="9">
                        <ion-input type="text" [value]="priceAux" (ionInput)="dotPrice($event.target)" style="height: 30px !important;" id="inputPasss" [disabled]="!editCar"></ion-input>
                      </ion-col>
                    </ion-row>
                  </ion-col>
                </ion-col>
              </ion-row>

            </ion-col>

            <ion-col size="12" >
              <ion-card>
                <ion-card-content>
                  <ion-row>
                    <ion-col sizeXl="6" sizeLg="6" sizeMd="6" sizeSm="6" sizeXs="6" *ngIf="carDetail.traction_control === 'true'">
                      <ion-img src="assets/images/logo/traccion.png" style="width: 25% !important;margin: 5px 0px !important"></ion-img>
                      <p style="font-size: 15px; font-weight: bold;">Control de tracción</p>
                      <span style="font-size: 10px; color: #898989">Estable y seguro</span>
                    </ion-col>

                    <ion-col sizeXl="6" sizeLg="6" sizeMd="6" sizeSm="6" sizeXs="6" *ngIf="carDetail.technology === 'true'">
                      <ion-img src="assets/images/logo/tecnologia.png" style="width: 29% !important;margin: 5px 0px !important"></ion-img>
                      <p style="font-size: 15px; font-weight: bold;">Tecnología</p>
                      <span style="font-size: 10px; color: #898989">Control de estabilidad(VSC)</span>
                    </ion-col>

                    <ion-col sizeXl="6" sizeLg="6" sizeMd="6" sizeSm="6" sizeXs="6" *ngIf="carDetail.performance === 'true'">
                      <ion-img src="assets/images/logo/performance.png" style="width: 25% !important;margin: 5px 0px !important"></ion-img>
                      <p style="font-size: 15px; font-weight: bold;">Performance</p>
                      <span style="font-size: 10px; color: #898989">V6 Twin Turbo (V35A-FTS)</span>
                    </ion-col>

                    <ion-col sizeXl="6" sizeLg="6" sizeMd="6" sizeSm="6" sizeXs="6" *ngIf="carDetail.comfort === 'true'">
                      <ion-img src="assets/images/logo/confort.png" style="width: 20% !important;margin: 5px 0px !important"></ion-img>
                      <p style="font-size: 15px; font-weight: bold;">Confort</p>
                      <span style="font-size: 10px; color: #898989">Asientos tapizados en cuero natural y ecologico</span>
                    </ion-col>
                  </ion-row>
                </ion-card-content>
              </ion-card>
            </ion-col>

            <ion-col size="12" *ngIf="carDetail.mechanicalFile">
              <ion-grid fixed>
                <ion-row>
                  <ion-col size="12" style="text-align: center;">
                    <p>Ficha Mécanica</p>
                  </ion-col>
                  <ion-col sizeXl="6" sizeLg="6" sizeMd="6" sizeSm="12" sizeXs="12">
                    <ion-row>
                      <ion-col size="12">
                        
                        <ion-row *ngIf="carDetail.general_condition ==='excelente'">
                          <ion-col size="12">
                            <span class="spanGenCon">Condición del vehículo:</span>
                          </ion-col>
                          <ion-col size="5" style="text-align: right !important;">
                            <ion-icon name="shield-checkmark-outline" style="font-size: 30px !important; color: #11D800 !important;margin-top: 5px !important"></ion-icon>
                          </ion-col>
                          <ion-col size="7"style="text-align: left !important;">
                            <p style="color: #11D800 !important;" class="pGenCon">Excelente</p>
                          </ion-col>
                        </ion-row>
                        <ion-row *ngIf="carDetail.general_condition ==='bueno'">
                          <ion-col size="12">
                            <span class="spanGenCon">Condición del vehículo:</span>
                          </ion-col>
                          <ion-col size="5" style="text-align: right !important;">
                            <ion-icon name="shield-checkmark-outline" style="font-size: 30px !important; color: #F9D616 !important;margin-top: 5px !important"></ion-icon>
                          </ion-col>
                          <ion-col size="7"style="text-align: left !important;">
                            <p style="color: #F9D616 !important;" class="pGenCon">Bueno</p>
                          </ion-col>
                        </ion-row>
                        <ion-row *ngIf="carDetail.general_condition ==='regular'">
                          <ion-col size="12">
                            <span class="spanGenCon">Condición del vehículo:</span>
                          </ion-col>
                          <ion-col size="5" style="text-align: right !important;">
                            <ion-icon name="help-circle-outline" style="font-size: 30px !important; color: #F7941D !important;margin-top: 5px !important"></ion-icon>
                          </ion-col>
                          <ion-col size="7"style="text-align: left !important;">
                            <p style="color: #F7941D !important;" class="pGenCon">Regular</p>
                          </ion-col>
                        </ion-row>
                
                        <ion-row *ngIf="carDetail.general_condition ==='malo'">
                          <ion-col size="12">
                            <span class="spanGenCon">Condición del vehículo:</span>
                          </ion-col>
                          <ion-col size="5" style="text-align: right !important;">
                            <ion-icon name="close-circle-outline" style="font-size: 30px !important; color: #EB0A1E !important;margin-top: 5px !important"></ion-icon>
                          </ion-col>
                          <ion-col size="7"style="text-align: left !important;">
                            <p style="color: #EB0A1E !important;" class="pGenCon">Malo</p>
                          </ion-col>
                        </ion-row>
                      </ion-col>
                    </ion-row>
                  </ion-col>
                  <ion-col sizeXl="6" sizeLg="6" sizeMd="6" sizeSm="12" sizeXs="12" style="text-align: center; margin: auto;">
                    <ion-button (click)="openFile(carDetail._id)" expand="block" shape="round" color="success">
                      Ver ficha
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>

            <ion-col size="12" *ngIf="carDetail.mechanicalFile && carDetail.id_seller ===myId && carDetail.price_ofert === null && carDetail.final_price_sold=== null&& carDetail.sold===false">
              <ion-grid fixed>
                <ion-row>
                  <ion-col size="12">
                    <ion-button expand="block" shape="round" color="success" (click)="editVehicle()" *ngIf="!editCar">
                      Editar
                    </ion-button>
                    <ion-button expand="block" shape="round" color="success" (click)="updateVehicle()" *ngIf="editCar">
                      guardar
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>

            <ion-col size="12" *ngIf="carDetail.id_seller_buyer===null && carDetail.price !== null ||carDetail.id_seller_buyer==='null' && carDetail.price !== null || carDetail.id_seller_buyer==='' && carDetail.price !== null&& carDetail.sold===false">
              <ion-grid fixed>
                <ion-row>
                  <ion-col size="12">
                    <ion-button expand="block" shape="round" color="success" (click)="openModalBuy()">
                      Comprar
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>

            <ion-col size="12" *ngIf="carDetail.id_seller_buyer!==null && carDetail.id_seller===myId && carDetail.price_ofert !== null&&carDetail.sold===false" style="text-align: center !important;">
              <p class="pText">Tienes una oferta por tu vehículo de ${{setDot(carDetail.price_ofert ? carDetail.price_ofert : 0)}}</p>
            </ion-col>

            <ion-col size="12" *ngIf="carDetail.id_seller_buyer!==null && carDetail.id_seller===myId&&carDetail.price_ofert !== null&& carDetail.final_price_sold === null&&carDetail.sold===false">
              <ion-grid fixed>
                <ion-row>
                  <ion-col size="6">
                    <ion-button expand="block" shape="round" (click)="approveBuyVehicle()" class="btnRed">
                      Aprobar
                    </ion-button>
                  </ion-col>
                  <ion-col size="6">
                    <ion-button expand="block" shape="round" (click)="rejectBuyVehicle()" class="btnRed">
                      Rechazar
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>
            
            <ion-col size="12" *ngIf="carDetail.id_seller_buyer!==null && carDetail.id_seller===myId&& carDetail.price_ofert !== null&& carDetail.final_price_sold !== null&& carDetail.sold===false">
              <ion-grid fixed>
                <ion-row>
                  <ion-col size="12">
                    <ion-button expand="block" shape="round" (click)="dispatched()" class="btnSaveRed">
                      Carro entregado 
                    </ion-button>
                  </ion-col>
                  <ion-col size="12">
                    <ion-button expand="block" shape="round" (click)="repost()" class="btnSaveRed">
                      Volver a publicar
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-modal #modalBuy>
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button color="medium" (click)="dismissModal()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Completar formulario</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
      
        <ion-grid fixed>
          <ion-row>
            
            <ion-col size="12" style="text-align: center !important;">
              <ion-label>Ofertar por vehículo</ion-label>
            </ion-col>

            <ion-col size="12">
              <ion-label style="font-size: 14px; color: #898989; margin: 10px 0px !important;">Precio</ion-label>
              <ion-input type="tel" fill="outline" [value]="priceOfertAux" (ionInput)="dotPriceOfert($event.target)"></ion-input>
            </ion-col>

            <ion-col size="12">
              <ion-label style="font-size: 14px; color: #898989; margin: 10px 0px !important;">Nombre del comprador</ion-label>
              <ion-input type="text" fill="outline" [(ngModel)]="fullName"></ion-input>
            </ion-col>

            <ion-col size="12">
              <ion-label style="font-size: 14px; color: #898989; margin: 10px 0px !important;">Cédula del comprador</ion-label>

              <ion-row>
                <ion-col size="4">
                  <ion-select [(ngModel)]="typeDni" interface="action-sheet" placeholder="tipo de vehículo" fill="outline" id="typeSelect">
                    <ion-select-option value="V">V</ion-select-option>
                    <ion-select-option value="E">E</ion-select-option>
                    <ion-select-option value="J">J</ion-select-option>
                    <ion-select-option value="G">G</ion-select-option>
                    <ion-select-option value="P">P</ion-select-option>
                  </ion-select>
                </ion-col>
                <ion-col size="8">
                  <ion-input type="text" fill="outline" [(ngModel)]="dni"></ion-input>
                </ion-col>
              </ion-row>

            </ion-col>

            <ion-col size="12">
              <ion-label style="font-size: 14px; color: #898989; margin: 10px 0px !important;">Teléfono del comprador</ion-label>
              <ion-input type="text" fill="outline" [(ngModel)]="phone"></ion-input>
            </ion-col>

            <ion-col size="12">
              <ion-label style="font-size: 14px; color: #898989; margin: 10px 0px !important;">Correo electrónico del comprador</ion-label>
              <ion-input type="text" fill="outline" [(ngModel)]="email"></ion-input>
            </ion-col>

            <ion-col size="12" style="text-align: left !important;">
              <ion-label>
                <strong>
                  ***NOTA: No incluye costo de traslado****
                </strong> 
              </ion-label>
            </ion-col>

            <ion-col size="12" style="margin-top: 50px !important">
              <ion-button  expand="block" shape="round" class="btnSaveRed" (click)="buyVehicle()">
                Ofertar
              </ion-button>
            </ion-col>
          
          </ion-row>
        </ion-grid>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-action-sheet  header="Opciones" [buttons]="actionSheetButtons" #actionSheet></ion-action-sheet>
  <ion-action-sheet header="Opciones" [buttons]="actionSheetButtonsEdit" #actionSheetEdit></ion-action-sheet>
</ion-content>

